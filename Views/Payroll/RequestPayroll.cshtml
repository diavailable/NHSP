@model NHSP.Models.FileModel
@{
    ViewData["Title"] = "Request Payroll";
}
<head>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet" />
</head>
<h1 style="text-align:center">Payroll Request</h1>
<div><h1></h1></div>
<table>
    <thead>
        <tr>
            <th>Site</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody>
        @if (ViewBag.Site != null)
        {
        foreach (var site in ViewBag.Site)
        {
            <tr>
                <td class="text-center text-nowrap">@site.SiteName</td>
                <td>
                    <button type="submit" class="btn btn-primary" data-siteid="@site.SiteId" id="showUpload_@site.SiteId">Upload</button>
                </td>
            </tr>
        }
        }
    </tbody>
</table>

<div class="modal fade" id="uploadModal" tabindex="-1" aria-labelledby="uploadModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div id="uploadModalBody">
                <!-- Content will be loaded here dynamically -->
            </div>
        </div>
    </div>
</div>


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.11.7/umd/popper.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
<script>
    $(document).ready(function () {
            $('button[id^="showUpload_"]').click(function (event) {
                event.preventDefault();

                var siteId = $(this).data('siteid');

                $.ajax({
                    url: '/Payroll/UploadPartial', // Update with your controller and action
                    type: 'GET',
                    data: { SiteId: siteId },
                    success: function (data) {
                        $('#uploadModalBody').html(data); // Load the partial view content into the modal body
                        var uploadModal = new bootstrap.Modal(document.getElementById('uploadModal'));
                        uploadModal.show();
                    },
                    error: function () {
                        alert('Failed to load the modal content.');
                    }
                });
            });

            $(document).on('submit', '#uploadForm', function (event) {
                event.preventDefault();

                var form = $(this);
                var formData = new FormData(this);

                $.ajax({
                    url: form.attr('action'),
                    type: 'POST',
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function (response) {
                        $('#uploadModalBody').html(response); // Reload the modal content with validation results
                    },
                    error: function () {
                        alert('File upload failed.');
                    }
                });
            });
        });
</script>